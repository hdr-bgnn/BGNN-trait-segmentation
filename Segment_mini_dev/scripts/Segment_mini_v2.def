BootStrap: docker
From: thibault79t/smp_env:v2

%setup
  mkdir -p ${SINGULARITY_ROOTFS}/pipeline

%post
  #git clone https://github.com/hdr-bgnn/BGNN-trait-segmentation.git /pipeline/BGNN-trait-segmentation
  git clone --branch segment_mini https://github.com/hdr-bgnn/BGNN-trait-segmentation.git /pipeline/BGNN-trait-segmentation
  cp /pipeline/BGNN-trait-segmentation/Segment_mini_dev/scripts/segmentation_main.py /pipeline/
  cp /pipeline/BGNN-trait-segmentation/Segment_mini_dev/scripts/helper_mini.py /pipeline/
  rm -r /pipeline/BGNN-trait-segmentation

  /home/user/miniconda/bin/gdown -O /pipeline/saved_models/ https://drive.google.com/uc?id=1HBSGXbWw5Vorj82buF-gCi6S2DpF4mFL
  chmod +x /pipeline/segmentation_main.py
  echo 'export PATH=$PATH:/pipeline' >> $SINGULARITY_ENVIRONMENT

#%files
#  helper_mini.py /pipeline/
#  segmentation_main.py /pipeline/

%labels
MAINTAINER tabarin@battelleecology.org

%help
  This container runs segmentation_main.py developed by M. Maruf from virginia tech group for bgnn project.
  Weights and training perform by M. Maruf
  Refactoring for containarization by Thibault Tabarin from Battelle

  Usage:
  singularity exec Segment_mini_v2.sif segmentation_main.py <fish_image_cropped.jpg> <Segemented.png>
